/*! Slideshow plugin for PhotoSwipe v5. https://github.com/htmltiger/photoswipe-slideshow */
class PhotoSwipeSlideshow{constructor(e,s){this.lightbox=e,this.options=Object.assign({defaultDelayMs:4e3,playPauseButtonOrder:6,progressBarPosition:"top",progressBarTransition:"ease",restartOnSlideChange:!0,autoHideProgressBar:!0},s),this.setSlideshowLength(Number(localStorage.getItem("pswp_delay"))||this.options.defaultDelayMs),document.head.insertAdjacentHTML("beforeend",`<style>.pswp__progress-bar{position:fixed;${this.options.progressBarPosition}:0;width:0;height:0}.pswp__progress-bar.running{width:100%;height:3px;transition-property:width;background:#c00}</style>`),this.slideshowIsRunning=!1,this.slideshowTimerID=null,this.wakeLockIsRunning=!1,this.wakeLockSentinel=null,this.lightbox.on("init",(()=>{this.init(this.lightbox.pswp)}))}init(e){e.on("uiRegister",(()=>{e.ui.registerElement({name:"playpause-button",title:"Toggle slideshow (Space)\nChange delay with +/- while running",order:this.options.playPauseButtonOrder,isButton:!0,html:'<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 32 32"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-play"/><use class="pswp__icn-shadow" xlink:href="#pswp__icn-stop"/><path id="pswp__icn-play" d="M9.5 6.4c-.7-.4-1.6-.4-2.3-0S6 7.5 6 8.2V23.9c0 .8.5 1.5 1.2 1.9s1.6.4 2.3-0l13.8-7.8a2.3 2.1 0 000-3.7z"/><path id="pswp__icn-stop" style="display:none" d="M6 9A3 3 90 019 6H23A3 3 90 0126 9V23a3 3 90 01-3 3H9A3 3 90 016 23z"/></svg>',onClick:(e,s)=>{this.setSlideshowState()}}),e.ui.registerElement({name:"playtime",appendTo:"wrapper",tagName:"div",className:"pswp__progress-bar"}),e.events.add(document,"keydown",(e=>{switch(e.code){case"Space":this.setSlideshowState(),e.preventDefault();break;case"ArrowUp":case"NumpadAdd":case"Equal":this.changeSlideshowLength(1e3),e.preventDefault();break;case"ArrowDown":case"NumpadSubtract":case"Minus":this.changeSlideshowLength(-1e3),e.preventDefault()}}))})),this.lightbox.on("change",(()=>{this.slideshowIsRunning&&this.options.restartOnSlideChange&&this.goToNextSlideAfterTimeout()})),this.lightbox.on("close",(()=>{this.slideshowIsRunning&&this.setSlideshowState()}))}setSlideshowState(){this.slideshowIsRunning=!this.slideshowIsRunning,this.slideshowIsRunning?this.goToNextSlideAfterTimeout():this.resetSlideshow(),document.querySelector("#pswp__icn-stop").style.display=this.slideshowIsRunning?"inline":"none",document.querySelector("#pswp__icn-play").style.display=this.slideshowIsRunning?"none":"inline",document.querySelector(".pswp__progress-bar").style.opacity=this.options.autoHideProgressBar?null:1,this.toggleWakeLock()}setSlideshowLength(e){this.options.defaultDelayMs=Math.min(Math.max(e,1e3),2147483647),this.options.defaultDelayMs!=e&&localStorage.setItem("pswp_delay",this.options.defaultDelayMs)}changeSlideshowLength(e){if(!this.slideshowIsRunning)return;this.setSlideshowLength(this.options.defaultDelayMs+e),localStorage.setItem("pswp_delay",this.options.defaultDelayMs);const s=document.querySelector(".pswp__counter");s&&(s.innerHTML=this.options.defaultDelayMs/1e3+"s"),this.goToNextSlideAfterTimeout()}isVideoContent(e){return"video"===e?.data?.type}getSlideTimeout(){const e=pswp.currSlide.content;if(this.isVideoContent(e)){const s=e.element;if(s.paused)return this.options.defaultDelayMs;const t=s.duration,i=s.currentTime;return isNaN(t)||isNaN(i)?this.options.defaultDelayMs:1e3*(t-i)}return this.options.defaultDelayMs}slideContentHasLoaded(){const e=pswp.currSlide.content;if(this.isVideoContent(e)){const s=e.element;return s.ended||s.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&[HTMLMediaElement.NETWORK_IDLE,HTMLMediaElement.NETWORK_LOADING].includes(s.networkState)}return!e.isLoading()}goToNextSlideAfterTimeout(){if(this.resetSlideshow(),this.slideContentHasLoaded()){const e=this.getSlideTimeout();this.slideshowTimerID=setTimeout((()=>{pswp.next(),this.options.restartOnSlideChange||this.goToNextSlideAfterTimeout()}),e),setTimeout((()=>{this.slideshowIsRunning&&this.toggleProgressBar(e)}),100)}else this.slideshowTimerID=setTimeout((()=>{this.goToNextSlideAfterTimeout()}),200)}getSlideTransition(){return this.isVideoContent(pswp.currSlide.content)?"linear":this.options.progressBarTransition}toggleProgressBar(e){const s=document.querySelector(".pswp__progress-bar");e?(s.style.transitionTimingFunction=this.getSlideTransition(),s.style.transitionDuration=`${e}ms`,s.classList.add("running")):s.classList.remove("running")}toggleWakeLock(){this.wakeLockIsRunning!=this.slideshowIsRunning&&("keepAwake"in screen?screen.keepAwake=this.slideshowIsRunning:"wakeLock"in navigator&&(this.wakeLockSentinel?this.wakeLockSentinel.release().then((()=>{this.wakeLockSentinel=null})):navigator.wakeLock.request("screen").then((e=>{this.wakeLockSentinel=e,this.wakeLockSentinel.addEventListener("release",(()=>{this.wakeLockSentinel=null,this.wakeLockIsRunning=!1}))})).catch((e=>{}))),this.wakeLockIsRunning=this.slideshowIsRunning)}resetSlideshow(){this.toggleProgressBar(),this.slideshowTimerID&&(clearTimeout(this.slideshowTimerID),this.slideshowTimerID=null)}}
export default PhotoSwipeSlideshow;
