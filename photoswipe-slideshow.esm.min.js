/*! Slideshow plugin for PhotoSwipe v5.  https://github.com/dpet23/photoswipe-slideshow */
const INT32_MAX=2147483647,SLIDESHOW_DELAY_STORAGE_KEY="pswp_delay",PROGRESS_BAR_CLASS="pswp__progress-bar",PROGRESS_BAR_RUNNING_CLASS="running",defaultOptions={defaultDelayMs:4e3,playPauseButtonOrder:6,progressBarPosition:"top",progressBarTransition:"ease",restartOnSlideChange:!1,autoHideProgressBar:!0};class PhotoSwipeSlideshow{constructor(e,t){this.lightbox=e,this.options={...defaultOptions,...t},this.setSlideshowLength(Number(localStorage.getItem("pswp_delay"))||this.options.defaultDelayMs),document.head.insertAdjacentHTML("beforeend",`<style>.${PROGRESS_BAR_CLASS}{position:fixed;${this.options.progressBarPosition}:0;width:0;height:0}.${PROGRESS_BAR_CLASS}.running{width:100%;height:3px;transition-property:width;background:#c00}</style>`),this.slideshowIsRunning=!1,this.slideshowTimerID=null,this.wakeLockIsRunning=!1,this.wakeLockSentinel=null,this.lightbox.on("init",(()=>{this.init(this.lightbox.pswp)}))}init(e){e.on("uiRegister",(()=>{e.ui.registerElement({name:"playpause-button",title:"Toggle slideshow (Space)\nChange delay with +/- while running",order:this.options.playPauseButtonOrder,isButton:!0,html:'<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 32 32"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-play"/><use class="pswp__icn-shadow" xlink:href="#pswp__icn-stop"/><path id="pswp__icn-play" d="M9.5038 6.4009c-.7102-.4052-1.603-.4185-2.3282-.0401S6 7.4522 6 8.2272V23.905c0 .775.451 1.4874 1.1762 1.8664s1.6174.3608 2.3282-.0401l13.8234-7.8392a2.3057 2.1395 0 000-3.6527z"/><path id="pswp__icn-stop" style="display:none" d="M6 9A3 3 90 019 6H23A3 3 90 0126 9V23a3 3 90 01-3 3H9A3 3 90 016 23z"/></svg>',onClick:(e,t)=>{this.setSlideshowState()}}),e.ui.registerElement({name:"playtime",appendTo:"wrapper",tagName:"div",className:PROGRESS_BAR_CLASS}),e.events.add(document,"keydown",(e=>{switch(e.code){case"Space":this.setSlideshowState(),e.preventDefault();break;case"ArrowUp":case"NumpadAdd":case"Equal":this.changeSlideshowLength(1e3),e.preventDefault();break;case"ArrowDown":case"NumpadSubtract":case"Minus":this.changeSlideshowLength(-1e3),e.preventDefault()}}))})),this.lightbox.on("change",(()=>{this.slideshowIsRunning&&this.options.restartOnSlideChange&&this.goToNextSlideAfterTimeout()})),this.lightbox.on("close",(()=>{this.slideshowIsRunning&&this.setSlideshowState()}))}setSlideshowState(){this.slideshowIsRunning=!this.slideshowIsRunning,this.slideshowIsRunning?this.goToNextSlideAfterTimeout():this.resetSlideshow(),document.querySelector("#pswp__icn-stop").style.display=this.slideshowIsRunning?"inline":"none",document.querySelector("#pswp__icn-play").style.display=this.slideshowIsRunning?"none":"inline",document.querySelector(`.${PROGRESS_BAR_CLASS}`).style.opacity=this.options.autoHideProgressBar?null:1,this.toggleWakeLock()}setSlideshowLength(e){this.options.defaultDelayMs=Math.min(Math.max(e,1e3),INT32_MAX),this.options.defaultDelayMs!=e&&localStorage.setItem("pswp_delay",this.options.defaultDelayMs)}changeSlideshowLength(e){if(!this.slideshowIsRunning)return;this.setSlideshowLength(this.options.defaultDelayMs+e),localStorage.setItem("pswp_delay",this.options.defaultDelayMs);const t=document.querySelector(".pswp__counter");t&&(t.innerHTML=this.options.defaultDelayMs/1e3+"s"),this.goToNextSlideAfterTimeout()}isVideoContent(e){return"video"===e?.data?.type}getSlideTimeout(){const e=pswp.currSlide.content;if(this.isVideoContent(e)){const t=e.element;if(t.paused)return this.options.defaultDelayMs;const s=t.duration,i=t.currentTime;return isNaN(s)||isNaN(i)?this.options.defaultDelayMs:1e3*(s-i)}return this.options.defaultDelayMs}slideContentHasLoaded(){const e=pswp.currSlide.content;if(this.isVideoContent(e)){const t=e.element;return t.ended||t.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&[HTMLMediaElement.NETWORK_IDLE,HTMLMediaElement.NETWORK_LOADING].includes(t.networkState)}return!e.isLoading()}goToNextSlideAfterTimeout(){if(this.resetSlideshow(),this.slideContentHasLoaded()){const e=this.getSlideTimeout();this.slideshowTimerID=setTimeout((()=>{pswp.next(),this.options.restartOnSlideChange||this.goToNextSlideAfterTimeout()}),e),setTimeout((()=>{this.slideshowIsRunning&&this.toggleProgressBar(e)}),100)}else this.slideshowTimerID=setTimeout((()=>{this.goToNextSlideAfterTimeout()}),200)}getSlideTransition(){return this.isVideoContent(pswp.currSlide.content)?"linear":this.options.progressBarTransition}toggleProgressBar(e){const t=document.querySelector(`.${PROGRESS_BAR_CLASS}`);e?(t.style.transitionTimingFunction=this.getSlideTransition(),t.style.transitionDuration=`${e}ms`,t.classList.add("running")):t.classList.remove("running")}toggleWakeLock(){this.wakeLockIsRunning!=this.slideshowIsRunning&&("keepAwake"in screen?screen.keepAwake=this.slideshowIsRunning:"wakeLock"in navigator&&(this.wakeLockSentinel?this.wakeLockSentinel.release().then((()=>{this.wakeLockSentinel=null})):navigator.wakeLock.request("screen").then((e=>{this.wakeLockSentinel=e,this.wakeLockSentinel.addEventListener("release",(()=>{this.wakeLockSentinel=null,this.wakeLockIsRunning=!1}))})).catch((e=>{}))),this.wakeLockIsRunning=this.slideshowIsRunning)}resetSlideshow(){this.toggleProgressBar(),this.slideshowTimerID&&(clearTimeout(this.slideshowTimerID),this.slideshowTimerID=null)}}export default PhotoSwipeSlideshow;